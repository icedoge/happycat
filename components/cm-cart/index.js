"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,i)}if("value"in a)return a.value;var r=a.get;return void 0!==r?r.call(i):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../interfaces/index.js"),_index4=require("../../constants/index.js"),_index5=require("../../api/index.js"),_lodash=require("../../npm/lodash/lodash.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var CmCart=(_temp2=_class=function(e){function r(){var e,t,n;_classCallCheck(this,r);for(var i=arguments.length,a=Array(i),s=0;s<i;s++)a[s]=arguments[s];return(t=n=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(a)))).$usedState=["cart","loopArray0","ECartDisplayMode","isAllBasketItemSelected","displayMode","isAllEditModeBasketItemSelected","__fn_on"],n.$$refs=[],_possibleConstructorReturn(n,t)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(e){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,e),this.onSelectAllChange=this.onSelectAllChange.bind(this),this.onChangeBasketItemSelect=this.onChangeBasketItemSelect.bind(this),this.onChangeEditModeBasketItemSelect=this.onChangeEditModeBasketItemSelect.bind(this),this.onChangeBasketItemAmount=this.onChangeBasketItemAmount.bind(this),this.onDeleteBasketItem=this.onDeleteBasketItem.bind(this),this.onSwitchViewMode=this.onSwitchViewMode.bind(this),this.state={cart:this.props.cart,isAllBasketItemSelected:!1,displayMode:_index3.ECartDisplayMode.View,isAllEditModeBasketItemSelected:!1}}},{key:"componentDidMount",value:function(){var e=this;this.setState({cart:this.props.cart},function(){e.updateSelectStates()}),_index2.default.eventCenter.on(_index4.CartEvents.DeleteEditModeSelectedBasketItems,function(){var n=!1;(0,_lodash.forEach)(e.state.cart.baskets,function(e){var t=(0,_lodash.filter)(e.items,{editModeSelected:!0});0<t.length&&(_index5.Cart.removeBasketItem(e,t),n=!0)}),n&&_index2.default.eventCenter.trigger(_index4.CartEvents.RefreshCart)})}},{key:"componentWillReceiveProps",value:function(){var e=this;this.setState({cart:this.props.cart},function(){e.updateSelectStates()})}},{key:"updateSelectStates",value:function(){var e=(0,_lodash.every)(this.state.cart.baskets,function(e){return(0,_lodash.every)(e.items,function(e){return e.selected})});this.setState({isAllBasketItemSelected:e})}},{key:"onSelectAllChange",value:function(){_index5.Cart.updateAllBasketItemSelect(!this.state.isAllBasketItemSelected).finally(function(){_index2.default.eventCenter.trigger(_index4.CartEvents.RefreshCart)})}},{key:"onChangeBasketItemSelect",value:function(e,t,n){_index5.Cart.updateBasketItemSelect(e,t,n).finally(function(){_index2.default.eventCenter.trigger(_index4.CartEvents.RefreshCart)})}},{key:"onChangeEditModeBasketItemSelect",value:function(e,t,n){var i=(0,_lodash.cloneDeep)(this.state.cart),a=(0,_lodash.find)(i.baskets,{id:e.id});if(a){var s=(0,_lodash.find)(a.items,{id:t.id});s&&(s.editModeSelected=n)}var r=(0,_lodash.every)(i.baskets,function(e){return(0,_lodash.every)(e.items,function(e){return e.editModeSelected})});this.setState({cart:i,isAllEditModeBasketItemSelected:r})}},{key:"onEditModeSelectAllChange",value:function(){var t=!this.state.isAllEditModeBasketItemSelected,e=(0,_lodash.cloneDeep)(this.state.cart);(0,_lodash.forEach)(e.baskets,function(e){(0,_lodash.forEach)(e.items,function(e){e.editModeSelected=t})}),this.setState({cart:e,isAllEditModeBasketItemSelected:t})}},{key:"onChangeBasketItemAmount",value:function(e,t,n){_index5.Cart.updateBasketItemAmount(e,t,n).finally(function(){_index2.default.eventCenter.trigger(_index4.CartEvents.RefreshCart)})}},{key:"onDeleteBasketItem",value:function(e,t){_index5.Cart.removeBasketItem(e,t).finally(function(){_index2.default.eventCenter.trigger(_index4.CartEvents.RefreshCart)})}},{key:"onSwitchViewMode",value:function(){switch(this.state.displayMode){case _index3.ECartDisplayMode.View:this.setState({displayMode:_index3.ECartDisplayMode.Edit}),_index2.default.eventCenter.trigger(_index4.CartEvents.SwitchEditMode);break;case _index3.ECartDisplayMode.Edit:this.setState({displayMode:_index3.ECartDisplayMode.View}),_index2.default.eventCenter.trigger(_index4.CartEvents.SwitchViewMode)}}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.__state.cart.baskets.map(function(e){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp2:String(e.$original.id),$original:e.$original}});return Object.assign(this.__state,{loopArray0:e,ECartDisplayMode:_index3.ECartDisplayMode}),this.__state}}]),r}(),_class.properties={cart:{type:null,value:null},__fn_on:{type:null,value:null}},_class.$$events=["onChangeBasketItemAmount","onChangeBasketItemSelect","onChangeEditModeBasketItemSelect","onDeleteBasketItem","onSelectAllChange","onEditModeSelectAllChange","onSwitchViewMode"],_temp2);exports.default=CmCart,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(CmCart));