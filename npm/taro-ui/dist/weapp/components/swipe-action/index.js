"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},_index=require("../../../../../@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../../../../prop-types/index.js"),_index4=_interopRequireDefault(_index3),_index5=require("../../../../../classnames/index.js"),_index6=_interopRequireDefault(_index5),_inRange2=require("../../../../../lodash/inRange.js"),_inRange3=_interopRequireDefault(_inRange2),_isFunction2=require("../../../../../lodash/isFunction.js"),_isFunction3=_interopRequireDefault(_isFunction2),_component=require("../../common/component.js"),_component2=_interopRequireDefault(_component),_utils=require("../../common/utils.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var AtSwipeAction=(_temp2=_class=function(e){function a(){var e,t,x;_classCallCheck(this,a);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=x=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(i)))).$usedState=["anonymousState__temp","anonymousState__temp2","anonymousState__temp7","loopArray0","rootClass","options","offsetSize","_isOpened","disabled","autoClose","className","isOpened","children"],x.handleOpened=function(){(0,_isFunction3.default)(x.props.onOpened)&&!x.state._isOpened&&x.__triggerPropsFn("onOpened",[null].concat([]))},x.handleClosed=function(){(0,_isFunction3.default)(x.props.onClosed)&&x.state._isOpened&&x.__triggerPropsFn("onClosed",[null].concat([]))},x.handleTouchStart=function(e){var t=e.touches[0],n=t.clientX,i=t.clientY;x.props.disabled||(x.startX=n,x.startY=i,x.isTouching=!0)},x.handleTouchMove=function(e){var t=x,n=t.startX,i=t.startY,o=x.domInfo,a=o.top,s=o.bottom,l=o.left,r=o.right,u=e.touches[0],_=u.clientX,p=u.clientY,d=u.pageX,c=u.pageY,f=Math.abs(_-n),h=Math.abs(p-i),y=(0,_inRange3.default)(d,l,r)&&(0,_inRange3.default)(c,a,s);if(!x.isMoving&&y&&(x.isMoving=0===h||f/h>=Math.tan(45*Math.PI/180).toFixed(2)),x.isTouching&&x.isMoving){var v=_-x.startX,m=0<v;if(0===x.state.offsetSize&&m)return;var g=x.endValue+v;x.setState({offsetSize:0<=g?0:g})}},x.handleTouchEnd=function(){x.isTouching=!1;var e=x.state.offsetSize;if(x.endValue=e,x.maxOffsetSize/2<Math.abs(e))return x._reset(!0),x.handleOpened();x._reset(),x.handleClosed()},x.handleDomInfo=function(e){var t=e.width,n=x.state._isOpened;x.maxOffsetSize=t,x._reset(n)},x.handleClick=function(e,t){for(var n=arguments.length,i=Array(2<n?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];var a=x.props,s=a.onClick,l=a.autoClose;(0,_isFunction3.default)(s)&&x.__triggerPropsFn("onClick",[null].concat([e,t].concat(i))),l&&(x._reset(),x.handleClosed())},x.$$refs=[],_possibleConstructorReturn(x,t)}return _inherits(a,_component2.default),_createClass(a,[{key:"_constructor",value:function(e){_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).apply(this,arguments);var t=e.isOpened;this.endValue=0,this.startX=null,this.startY=null,this.maxOffsetSize=0,this.domInfo={},this.isMoving=!1,this.isTouching=!1,this.state={offsetSize:0,_isOpened:t}}},{key:"componentDidMount",value:function(){var t=this;(0,_utils.delayQuerySelector)(_index2.default.getEnv()===_index2.default.ENV_TYPE.WEB?this:this.$scope,".at-swipe-action").then(function(e){t.domInfo=e[0]})}},{key:"componentWillReceiveProps",value:function(e){var t=e.isOpened;t!==this.state._isOpened&&this._reset(t)}},{key:"_reset",value:function(e){this.isMoving=!1,this.isTouching=!1,e?(this.endValue=-this.maxOffsetSize,this.setState({_isOpened:!0,offsetSize:-this.maxOffsetSize})):(this.endValue=0,this.setState({offsetSize:0,_isOpened:!1}))}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.__state.offsetSize,n=this.__props.options,t=(0,_index6.default)("at-swipe-action",this.__props.className),i=(0,_index6.default)("at-swipe-action__content",{animtion:!this.isTouching}),o=(0,_index.internal_inline_style)({transform:e?"translate3d("+e+"px,0,0)":null}),a=Array.isArray(n)&&0<n.length,s=a?n.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp4:Array.isArray(n)&&0<n.length?(0,_index.internal_inline_style)(e.$original.style):null,$loopState__temp6:Array.isArray(n)&&0<n.length?(0,_index6.default)("at-swipe-action__option",e.$original.className):null,$original:e.$original}}):[];return Object.assign(this.__state,{anonymousState__temp:i,anonymousState__temp2:o,anonymousState__temp7:a,loopArray0:s,rootClass:t,options:n}),this.__state}}]),a}(),_class.properties={onOpened:{type:null,value:null},__fn_onOpened:{type:null,value:null},onClosed:{type:null,value:null},__fn_onClosed:{type:null,value:null},disabled:{type:null,value:null},onClick:{type:null,value:null},autoClose:{type:null,value:null},__fn_onClick:{type:null,value:null},options:{type:null,value:null},className:{type:null,value:null},isOpened:{type:null,value:null}},_class.$$events=["handleTouchMove","handleTouchEnd","handleTouchStart","handleDomInfo","handleClick"],_temp2);AtSwipeAction.defaultProps={options:[],isOpened:!1,disabled:!1,autoClose:!1},AtSwipeAction.propTypes={isOpened:_index4.default.bool,disabled:_index4.default.bool,autoClose:_index4.default.bool,options:_index4.default.arrayOf(_index4.default.shape({text:_index4.default.string,style:_index4.default.oneOfType([_index4.default.object,_index4.default.string]),className:_index4.default.oneOfType([_index4.default.object,_index4.default.string,_index4.default.array])})),onClick:_index4.default.func,onOpened:_index4.default.func,onClosed:_index4.default.func},exports.default=AtSwipeAction,Component(require("../../../../../@tarojs/taro-weapp/index.js").default.createComponent(AtSwipeAction));