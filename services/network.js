"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Network=void 0;var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_index=require("../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_lodash=require("../npm/lodash/lodash.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function isValidValue(e){return(0,_lodash.isObject)(e)||(0,_lodash.isString)(e)?!(0,_lodash.isEmpty)(e):null!=e&&!(0,_lodash.isNaN)(e)}function cleanParams(e){var t=(0,_lodash.cloneDeep)(e);for(var n in t){isValidValue(t[n])||delete t[n]}return t}function formatUrlPath(e,s){var i=/\{([\w.-]+)?\}/;return e=e.replace(/\{([\w.-]+)?\}/gm,function(e){var t=i.exec(e);if(t){var n=t[1],r=s[n];return r&&delete s[n],null==r?"":r}return""})}var NetworkResponse=function(){function n(e){_classCallCheck(this,n),this._promise=e}return _createClass(n,[{key:"then",value:function(e,t){return new n(this._promise.then(e,t))}},{key:"success",value:function(t){return this._promise.then(function(e){t(e.data,e.statusCode)}),this}},{key:"error",value:function(t){return this._promise.catch(function(e){t(e.data.message,e.data.status)}),this}},{key:"finally",value:function(e){return this.then(function(){e()},function(){e()}),this}}]),n}(),Network=function(){function e(){_classCallCheck(this,e),this._requestOptions={header:{"content-type":"application/json;charset=utf-8"}}}return _createClass(e,[{key:"linkFullPath",value:function(e){var t=e;return e.startsWith("/")&&(t=e.slice(1)),this._service+"/"+t}},{key:"get",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.request(e,t,"GET",n)}},{key:"post",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.request(e,t,"POST",n)}},{key:"put",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.request(e,t,"PUT",n)}},{key:"delete",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.request(e,t,"DELETE",n)}},{key:"request",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},s=cleanParams(t),i=formatUrlPath(e,s),a=(0,_lodash.merge)({},this._requestOptions,r),u=_index2.default.request((0,_lodash.assign)({},a,{url:this.linkFullPath(i),data:s,method:n})).then(function(n){return new Promise(function(e,t){200<=n.statusCode&&n.statusCode<300?e(n):t(n)})});return new NetworkResponse(u)}},{key:"service",get:function(){return this._service},set:function(e){this._service=e}},{key:"headers",get:function(){return this._requestOptions.header},set:function(e){(0,_lodash.assign)(this._requestOptions.header,e)}}]),e}(),singleton=new Network;exports.Network=singleton;